# ti.macos.panels Module

Mac-focused Titanium native module for file panels.

## Scope

- `pickFolder(options?, callback?)`
- `pickFile(options?, callback?)`
- `pickFiles(options?, callback?)`
- `openDocument(options?, callback?)`
- `openDocuments(options?, callback?)`
- `saveFile(options?, callback?)`

Backed by `NSOpenPanel` and `NSSavePanel`.

## Requirements

1. Titanium SDK `13.2.0+`
2. Module platform `iphone` with `mac: true`
3. Mac Catalyst runtime
4. App entitlements for user-selected file access

## Entitlements (App `tiapp.xml`)

Minimum:

```xml
<key>com.apple.security.files.user-selected.read-write</key>
<true/>
```

## Unified Result

All APIs use this shape:

```js
{
  success: Boolean,
  cancelled: Boolean,
  canceled: Boolean,
  code: String | null,
  message: String | null,
  panel: 'open' | 'save',
  selectionType: 'folder' | 'file' | 'files' | 'document' | 'documents' | 'save',
  path: String | null,
  paths: String[],
  fileName: String | null,
  extension: String | null
}
```

## Error Codes

- `ERR_NOT_SUPPORTED_PLATFORM`
- `ERR_INVALID_OPTIONS`
- `ERR_PANEL_UNAVAILABLE`
- `ERR_USER_CANCELLED`
- `ERR_NO_SELECTION`
- `ERR_INVALID_START_DIRECTORY`

## Options

Common:

1. `title: String`
2. `prompt: String`
3. `directoryURL: String` (existing directory)
4. `showHiddenFiles: Boolean`
5. `canCreateDirectories: Boolean`

Open panel:

1. `resolvesAliases: Boolean`
2. `allowedExtensions: String | String[]`
3. `allowedContentTypes: String | String[]` (UTType)
4. `allowMultiple: Boolean` (`pickFiles` only)

Save panel:

1. `defaultName: String`
2. `defaultExtension: String`

If both filters are provided, `allowedContentTypes` has priority over `allowedExtensions`.

## Usage

```js
const macPanel = require('ti.macos.panels')

macPanel.pickFolder({ title: 'Choose folder' }, function (result) {
  if (!result.success) { return }
  Ti.API.info(result.path)
})

macPanel.openDocuments({
  title: 'Open docs',
  allowedExtensions: ['txt', 'json']
}, function (result) {
  if (!result.success) { return }
  Ti.API.info(JSON.stringify(result.paths))
})

macPanel.saveFile({
  title: 'Save export',
  defaultName: 'export',
  defaultExtension: 'txt'
}, function (result) {
  if (!result.success) { return }
  Ti.Filesystem.getFile(result.path).write('Generated by ti.macos.panels')
})
```

`saveFile()` selects destination only; your app writes the content.

## Read Files with Ti.Filesystem

The module returns file/folder paths. Use `Ti.Filesystem` for read/write:

```js
macPanel.pickFile({ title: 'Choose one file' }, function (result) {
  if (!result.success || !result.path) { return }
  const file = Ti.Filesystem.getFile(result.path)
  const blob = file.read()
  Ti.API.info(blob ? blob.text : '')
})

macPanel.pickFiles({ title: 'Choose files' }, function (result) {
  if (!result.success || !Array.isArray(result.paths)) { return }
  result.paths.forEach(function (selectedPath) {
    const file = Ti.Filesystem.getFile(selectedPath)
    const blob = file.read()
    Ti.API.info(selectedPath + ' -> ' + (blob ? blob.length : 0) + ' bytes')
  })
})
```

## License

MIT
